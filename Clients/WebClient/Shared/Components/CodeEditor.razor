@inherits ComponentBase
@using HeroIcons.Blazor.Outline
@using WebClient.Models

<div class="mt-14 h-fit w-full overflow-hidden rounded-lg border border-black/[.1] bg-slate-200">
  <div class="flex h-8 w-full items-center border-b overflow-hidden border-b-black/[.1] bg-slate-100">
    <ul class="flex h-full w-full overflow-x-auto overflow-y-hidden thin-scroll ">
      @foreach (CodeFileModel file in Files)
      {
        <li class="@(file.Id == CurrentId ? "bg-white/[.7]" : "bg-transparent") h-full group/tab flex gap-1 border-r border-r-black/[.1] pl-3 pr-3 sm:pr-2 hover:bg-white/[.5]">
          <button
            type="button"
            @onclick="() => SwitchFile(file.Id)"
            class="flex h-full items-center">
            <p class="text-xs">@file.Title</p>
          </button>
          <div class="group/del h-full items-center justify-center hidden sm:flex w-4">
            <button
              type="button"
              @onclick="() => DeleteFile(file.Id)"
              class="w-[15px] h-[15px] @(file.Id == CurrentId ? "text-gray-700" : "text-gray-500") flex mt-[2px] items-center justify-center rounded-full overflow-hidden group-hover/del:bg-gray-200 group-hover/del:text-gray-800 group-active/del:text-black">
              <XIcon class="w-3 h-3" />
            </button>
          </div>
        </li>
      }
      @if (!IsReadOnly)
      {
        <li class="flex h-full items-center pl-2">
          <button
            type="button"
            @onclick="() => AddFile()"
            class="flex h-4 w-4 items-center justify-center rounded-full hover:bg-white"
          >
            <p class="pb-1 text-slate-800">+</p>
          </button>
        </li>
      }
    </ul>
    <div class="h-full">
      <button
        type="button"
        id="editorContextMenuButton"
        data-dropdown-offset-skidding="-60"
        data-dropdown-toggle="editorContextMenu"
        class="w-6 border-l border-l-black/[.1] h-full flex items-center justify-center hover:bg-slate-200"
      >
        <DotsVerticalIcon class="text-gray-700 h-4 w-4" />
      </button>
      <div
        id="editorContextMenu"
        class="z-10 hidden py-1 bg-slate-100 divide-y divide-black/[.1] border border-black/[.1] rounded-lg shadow w-fit"
      >
        @if (!IsReadOnly)
        {
          <ul
            class="py-1 text-sm text-gray-700"
            aria-labelledby="editorContextMenuButton"
          >
            <li>
              <button
                type="button"
                data-modal-target="deleteFileModal"
                data-modal-toggle="deleteFileModal"
                class="px-3 py-1 flex w-full hover:bg-white/[.5] items-center gap-2"
              >
                <TrashIcon class="h-3 w-3 text-red-600" />
                <p class="text-red-600">Delete file</p>
              </button>
            </li>
            <li>
              <button
                type="button"
                data-modal-target="editFileNameModal"
                data-modal-toggle="editFileNameModal"
                class="px-3 py-1 flex w-full hover:bg-white/[.5] items-center gap-2"
              >
                <PencilIcon class="h-3 w-3 text-gray-700"/>
                <p class="text-gray-600">Rename file</p>
              </button>
            </li>
          </ul>
        }
        <ul
          class="py-1 text-sm text-gray-700 "
          aria-labelledby="editorContextMenuButton"
        >
          @if (!IsOwner)
          {
            <li>
              <button
                type="button"
                data-modal-target="editFileNameModal"
                data-modal-toggle="editFileNameModal"
                class="px-3 py-1 flex w-full hover:bg-white/[.5] items-center gap-2">
                <DocumentDuplicateIcon class="h-3 w-3 text-gray-700"/>
                <p class="text-gray-600">Clone Project</p>
              </button>
            </li>
          }
          @if (IsOwner)
          {
            <li>
              <button
                type="button"
                data-modal-target="editFileNameModal"
                data-modal-toggle="editFileNameModal"
                class="px-3 py-1 flex w-full hover:bg-white/[.5] items-center gap-2">
                <TrashIcon class="h-3 w-3 text-gray-700"/>
                <p class="text-gray-600 line-clamp-1">Remove Project</p>
              </button>
            </li>
          }
        </ul>
      </div>
    </div>

  </div>
  <div class="w-full bg-white">
    <CodeMirrorWrapper
      @bind-Text="CurrentFile.Text"
      TabSize="4"
      ReadOnly="@IsReadOnly"
      Language="@ActiveLanguage"
    />
  </div>
</div>

<div
  id="deleteFileModal"
  tabindex="-1"
  aria-hidden="true"
  class="fixed top-0 left-0 right-0 z-50 hidden h-screen p-4 overflow-x-hidden overflow-y-auto md:inset-0"
>
  <div class="w-full p-4 max-w-xs max-h-full flex border border-black/[.1] flex-col items-center bg-slate-100 rounded-lg shadow">
    <div class="p-2 text-center">
      <p>
        Are you sure you want to delete file?
      </p>
    </div>
    <div class="flex gap-4 items-center p-2 pt-3">
      <button
        data-modal-hide="deleteFileModal"
        type="button"
        @onclick="() => DeleteFile(CurrentId)"
        class="bg-sky-400 border hover:bg-sky-500 transition-colors border-black/[.1] px-4 py-2 rounded-lg overflow-hidden"
      >
        <p class="text-white text-sm">Sure</p>
      </button>
      <button
        data-modal-hide="deleteFileModal"
        type="button"
        class="text-gray-500 hover:text-gray-700 transition px-4 py-2 rounded-lg border border-black/[.1] overflow-hidden hover:bg-slate-200"
      >
        <p class="text-sm">Cancel</p>
      </button>
    </div>
  </div>
</div>

<div
  id="editFileNameModal"
  tabindex="-1"
  aria-hidden="true"
  class="fixed top-0 left-0 right-0 z-50 hidden h-screen p-4 overflow-x-hidden overflow-y-auto md:inset-0"
>
  <div class="w-full p-4 max-w-xs max-h-full flex border border-black/[.1] flex-col items-center bg-slate-100 rounded-lg shadow">
    <div class="p-2 px-6 w-full">
      <label for="fileName" class="text-sm">
        File name
      </label>
      <div class="mt-1">
        <input
          type="text"
          id="fileName"
          @bind="InputFileName"
          class="h-10 w-full rounded-md border border-black/[.2] px-2 text-sm shadow-sm"
          placeholder="Enter file name..."
        />
      </div>
    </div>
    <div class="flex gap-4 items-center p-2">
      <button
        data-modal-hide="editFileNameModal"
        type="button"
        @onclick="ChangeFileName"
        class="bg-sky-400 border hover:bg-sky-500 transition-colors border-black/[.1] px-4 py-2 rounded-lg overflow-hidden"
      >
        <p class="text-white text-sm">Change</p>
      </button>
      <button
        data-modal-hide="editFileNameModal"
        type="button"
        class="text-gray-500 hover:text-gray-700 transition px-4 py-2 rounded-lg border border-black/[.1] overflow-hidden hover:bg-slate-200"
      >
        <p class="text-sm">Cancel</p>
      </button>
    </div>
  </div>
</div>
